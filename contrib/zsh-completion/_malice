#compdef malice

integer ret=1
typeset -A opt_args

local opts_help='(: -)--help[Print usage]'

local -a _1st_arguments
_1st_arguments=(
   'scan:Scan a file:scan:file:_files' \
   'elk:Start an ELK docker container' \
   'web:Start, Stop Web services' \
   'plugin:List, Install or Remove Plugins' \
   'help:Shows a list of commands or help for one command'
)

_arguments \
  '(- :)'{-D,--debug}'[Enable debug mode \[$MALICE_DEBUG\]]' \
  '(- :)'{-h,--help}'[show help]' \
  '(- :)'{-v,--version}'[print the version]' \
  '*:: :->subcmds' && return 0

if (( CURRENT == 1 )); then
  _describe -t commands "malice subcommand" _1st_arguments
  return
fi

__scan() {
  _files
}

__elk() {
  _arguments \
    '--logs[Display the Logs from the ELK Container]'
    ret=0
}

__web() {
  local -a web_commands
  web_commands=(
      'start:start web application'
      'stop:stop web application'
  )
  _describe 'web actions' web_commands -- && return 0
}

__plugin() {
   local plugin_commands; plugin_commands=(
     'list:list enabled installed plugins'
     'install:install plugin'
     'update:update plugin'
     'remove:remove plugin'
    )
    _describe -t plugin_commands 'plugin commands' plugin_commands && return 0
}

__get_plugins() {
    local -a all_plugins
    all_plugins=( $(malice plugin list --all) )
    _multi_parts / all_plugins
}

case "$words[1]" in
  (scan)
    _arguments \
        $opts_help
    __scan && ret=0
    ;;
  (elk)
    _arguments \
        $opts_help
    __elk && ret=0
    ;;
  (web)
    _arguments \
        $opts_help
    __web && ret=0
    ;;
  plugin)
    _arguments \
        $opts_help
    __plugin && ret=0
    ;;
esac
