#compdef malice

typeset -A opt_args

local -a _1st_arguments
_1st_arguments=(
   'scan:Scan a file:scan:file:_files' \
   'elk:Start an ELK docker container' \
   'web:Start, Stop Web services' \
   'plugin:List, Install or Remove Plugins' \
   'help:Shows a list of commands or help for one command'
)

_arguments \
  '(--debug)--debug[Enable debug mode \[$MALICE_DEBUG\]]' \
  '(--help)--help[Print help message]' \
  '(--version)--version[Print version]' \
  '*:: :->subcmds' && return 0

if (( CURRENT == 1 )); then
  _describe -t commands "malice subcommand" _1st_arguments
  return
fi

__scan() {
  _files
}

__elk() {
  _arguments \
    '--logs[Display the Logs from the ELK Container]'
    ret=0
}

__web() {
  local -a web_commands
  web_commands=(
      'start:start web application'
      'stop:stop web application'
  )
  _describe 'web actions' web_commands -- && return 0
}

__plugin() {
   local plugin_commands; plugin_commands=(
     'list:list enabled installed plugins'
     'install:install plugin'
     'update:update plugin'
     'remove:remove plugin'
    )
    _describe -t plugin_commands 'plugin commands' plugin_commands && return 0
}

__get_plugins() {
    local -a all_plugins
    all_plugins=( $(malice plugin list --all) )
    _multi_parts / all_plugins
}

case "$words[1]" in
  scan)
    __scan ;;
  elk)
    __elk ;;
  web)
    __web ;;
  plugin)
    __plugin ;;
esac
